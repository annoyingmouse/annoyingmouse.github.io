<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./css/bootstrap.css" />
        <link rel="stylesheet" href="./css/bootstrap-responsive.css" />
        <link rel="stylesheet" href="./css/captcha.css"/>
        <style>
            body {
                padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
            }
        </style>
        <title>Hyde</title>
    </head>
    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="https://googledrive.com/host/0ByRgQIhodQXfaVdHOElsZTV5c3c/driveblog/">Hyde</a>
                    <div class="nav-collapse">
                        <ul class="nav" id="siteLinks"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <script type="text/javascript">var submitted=false;</script>
            <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted){window.location='https://googledrive.com/host/0ByRgQIhodQXfaVdHOElsZTV5c3c/driveblog/';}"></iframe>
            <section id="content"></section>
        </div>
        <script src="./js/jquery.js"></script>
        <script src="./js/jquery-ui.js"></script>
        <script src="./js/jquery.ui.touch-punch.js"></script>
        <script src="./js/bootstrap.js"></script>
        <script src="./js/jsrender.js"></script>
        <script src="./js/functions.js"></script>
        <script src="./js/captcha.js"></script>
        <script src="./js/showdown.js"></script>
        <script src="./js/comments.js"></script>
        <script src="./js/templates.js"></script>
        <script>
            var posts = [];
            var comments = [];
            // Determine location of sheets using: https://spreadsheets.google.com/feeds/worksheets/YOUR_SPREADSHEET_ID/private/full
            $(function(){
                var converter = new Showdown.converter();
                $.ajax({
                    dataType: "json",
                    url: "https://spreadsheets.google.com/feeds/list/0AiRgQIhodQXfdGZ5OV9INlNRME9YUnc2VUhmRGtPaVE/od9/public/values?alt=json",
                    success: function(data){
                        $.each(data.feed.entry, function(k, v){
                            var post = {};
                            post.id = parseInt(v.gsx$id.$t);
                            post.date = v.gsx$date.$t;
                            post.title = v.gsx$title.$t;
                            post.content = converter.makeHtml(v.gsx$content.$t);
                            post.link = encodeURI(v.gsx$title.$t);
                            post.pubdate = createDateStamp(v.gsx$date.$t);
                            posts.push(post);
                        });
                        $.each(posts, function(k, post){
                            //$("#content").append($("#addPost").render(post));
                            $("#content").append($.render.addPost(post));
                            addPostLinks(k, post.id, post.title);
                        });
                        $(".form-horizontal").hide();
                        $.ajax({
                            dataType: "json",
                            url: "https://spreadsheets.google.com/feeds/list/0AiRgQIhodQXfdGZ5OV9INlNRME9YUnc2VUhmRGtPaVE/ocy/public/values?alt=json",
                            success: function(data){
                                if(!empty(data.feed.entry)){
                                    $.each(data.feed.entry, function(k, v){
                                        var comment = {};
                                        comment.postId = parseInt(v.gsx$postid.$t, 10);
                                        comment.content = converter.makeHtml(v.gsx$what.$t);
                                        comment.date = v.gsx$timestamp.$t;
                                        comment.pubdate = createDateStamp(v.gsx$timestamp.$t);
                                        comment.who = v.gsx$who.$t;
                                        comment.icon = md5(v.gsx$who.$t);
                                        comments.push(comment);
                                    });
                                    $.each(comments, function(k,comment){
                                        //$("article[data-id='"+comment.postId+"'] .comments").append($("#addComment").render(comment))
                                        $("article[data-id='"+comment.postId+"'] .comments").append($.render.addComment(comment));

                                    });
                                    $(".post").each(function(){
                                        var $this = $(this);
                                        var commentsSection = $this.find(".comments");
                                        if(commentsSection.find("article").length === 0){
                                            commentsSection.hide();
                                        }
                                    });
                                }
                            }
                        });
                    }
                });
            });
        </script>
    </body>
</html>