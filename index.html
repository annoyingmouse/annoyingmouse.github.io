<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./css/bootstrap.css" />
        <link rel="stylesheet" href="./css/bootstrap-responsive.css" />
        <link rel="stylesheet" href="./css/captcha.css"/>
        <link rel="stylesheet" href="./css/default.css">
        <style>
            body {
                padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
            }
        </style>
        <title>Hyde</title>
    </head>
    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="https://annoyingmouse.github.io/">Hyde</a>
                    <div class="nav-collapse">
                        <ul class="nav" id="siteLinks"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <script type="text/javascript">var submitted=false;</script>
            <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted){window.location='http://annoyingmouse.github.io/';}"></iframe>
            <section id="content"></section>
        </div>
        <script src="./js/jquery.js"></script>
        <script src="./js/jquery-ui.js"></script>
        <script src="./js/jquery.ui.touch-punch.js"></script>
        <script src="./js/bootstrap.js"></script>
        <script src="./js/jsrender.js"></script>
        <script src="./js/functions.js"></script>
        <script src="./js/captcha.js"></script>
        <script src="./js/showdown.js"></script>
        <script src="./js/comments.js"></script>
        <script src="./js/templates.js"></script>
        <script src="./js/highlight.pack.js"></script>
        <script>
            // Determine location of sheets using: https://spreadsheets.google.com/feeds/worksheets/0AiRgQIhodQXfdGhhdTZDaEdjTy1ZV3h4T215NFRDUmc/private/full
            var posts = [];
            var comments = [];
            var converter = new Showdown.converter();
            function displayBlog(data){
                $.each(data.feed.entry, function(k, v){
                    var post = {};
                    post.id = parseInt(v.gsx$id.$t);
                    post.date = v.gsx$date.$t;
                    post.title = v.gsx$title.$t;
                    post.content = converter.makeHtml(v.gsx$content.$t);
                    post.link = encodeURI(v.gsx$title.$t);
                    post.pubdate = createDateStamp(v.gsx$date.$t);
                    posts.push(post);
                });
                $.each(posts, function(k, post){
                    $("#content").append($.render.addPost(post));
                    addPostLinks(k, post.id, post.title);
                });
                $(".form-horizontal").hide();
                $.ajax({
                    dataType: "json",
                    url: "https://spreadsheets.google.com/feeds/list/0AiRgQIhodQXfdGhhdTZDaEdjTy1ZV3h4T215NFRDUmc/ocy/public/values?alt=json",
                    success: function(data){
                        if(!empty(data.feed.entry)){
                            $.each(data.feed.entry, function(k, v){
                                var comment = {};
                                comment.postId = parseInt(v.gsx$postid.$t, 10);
                                comment.content = converter.makeHtml(v.gsx$what.$t);
                                comment.date = v.gsx$timestamp.$t;
                                comment.pubdate = createDateStamp(v.gsx$timestamp.$t);
                                comment.who = v.gsx$who.$t;
                                comment.icon = md5(v.gsx$who.$t);
                                comments.push(comment);
                            });
                            $.each(comments, function(k,comment){
                                $("article[data-id='"+comment.postId+"'] .comments").append($.render.addComment(comment));
                            });
                            $(".post").each(function(){
                                var $this = $(this);
                                var commentsSection = $this.find(".comments");
                                if(commentsSection.find("article").length === 0){
                                    commentsSection.hide();
                                }
                            });
                        }
                        $("pre code").each(function(i, e) {
                            hljs.highlightBlock(e)
                        });
                    }
                });
            }
        </script>
        <script src="https://spreadsheets.google.com/feeds/list/0AiRgQIhodQXfdGhhdTZDaEdjTy1ZV3h4T215NFRDUmc/1/public/values?alt=json-in-script&callback=displayBlog"></script>
    </body>
</html>